<div class="app-container">
  <!-- Sidebar -->
  <app-sidebar></app-sidebar>

  <!-- Contenu principal -->
  <div class="main-content">
    <div class="dashboard-container">
      <!-- Alert Banner -->
      <div class="alert" *ngIf="stockAlerts && stockAlerts.length > 0">
        <i class="fas fa-exclamation-triangle"></i>
        <span>Attention: Niveau d'aliments bas ! Stock restant pour {{ calculateAutonomy(stockAlerts[0].currentStock) }} jours.</span>
      </div>

      <!-- Dashboard Grid -->
      <div class="dashboard-grid">
        <!-- Feeding System Card -->
        <div class="card card-lg">
          <div class="card-header">
            <h2 class="card-title">
              <i class="fas fa-drumstick-bite"></i>
              Système d'alimentation
            </h2>
          </div>

          <!-- System Status -->
          <div class="status-details">
            <div class="status-item">
              <div class="status-label">État du système</div>
              <div class="status-value" [ngClass]="{'active': isFeedingSystemActive, 'inactive': !isFeedingSystemActive}">
                <button class="toggle-btn" (click)="toggleFeedingSystem()">
                  {{ isFeedingSystemActive ? 'En marche' : 'Arrêté' }}
                  <i class="fas" [ngClass]="{'fa-play-circle': !isFeedingSystemActive, 'fa-stop-circle': isFeedingSystemActive}"></i>
                </button>
              </div>
            </div>
            <div class="status-item">
              <div class="status-label">Dernière distribution</div>
              <div class="status-value">
                <i class="fas fa-history"></i>
                {{ lastFeedingTime || '--:--' }}
              </div>
            </div>
            <div class="status-item">
              <div class="status-label">Prochaine distribution</div>
              <div class="status-value">
                <i class="fas fa-clock"></i>
                {{ nextFeedingTime || '--:--' }}
              </div>
            </div>
          </div>

          <!-- Food Tank Level -->
          <div class="progress-container">
            <h3>Niveau du réservoir d'aliments</h3>
            <div class="progress-bar">
              <div class="progress" 
                   [style.width.%]="foodTankLevel"
                   [ngClass]="{
                     'low': foodTankLevel < 20,
                     'medium': foodTankLevel >= 20 && foodTankLevel < 50,
                     'high': foodTankLevel >= 50
                   }">
                <div class="progress-text">{{ foodTankLevel }}%</div>
              </div>
            </div>
          </div>

          <!-- Feeding Programs -->
          <div class="programs-container">
            <h3>Programmes d'alimentation</h3>
            <div *ngIf="feedingPrograms && feedingPrograms.length > 0; else noPrograms">
              <div class="program-item" *ngFor="let program of feedingPrograms; let i = index; trackBy: trackByFn">
                <div class="schedule-input">
                  <div class="input-group">
                    <label [for]="'type-' + i">Type</label>
                    <input [id]="'type-' + i"
                           type="text"
                           [(ngModel)]="program.type"
                           [name]="'type-' + i"
                           disabled>
                  </div>
                  <div class="input-group">
                    <label [for]="'quantity-' + i">Quantité (kg)</label>
                    <input [id]="'quantity-' + i"
                           type="number"
                           [(ngModel)]="program.quantity"
                           [name]="'quantity-' + i"
                           min="0"
                           step="0.5"
                           (change)="updateProgram(program)">
                  </div>
                  <div class="input-group">
                    <label [for]="'start-' + i">Heure de début</label>
                    <input [id]="'start-' + i"
                           type="time"
                           [(ngModel)]="program.programStartTime"
                           [name]="'start-' + i"
                           (change)="updateProgram(program)">
                  </div>
                  <div class="input-group">
                    <label [for]="'end-' + i">Heure de fin</label>
                    <input [id]="'end-' + i"
                           type="time"
                           [(ngModel)]="program.programEndTime"
                           [name]="'end-' + i"
                           (change)="updateProgram(program)">
                  </div>
                  <button class="delete-btn" (click)="deleteProgram(i)">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </div>
            </div>
            <ng-template #noPrograms>
              <p class="no-data">Aucun programme d'alimentation enregistré.</p>
            </ng-template>
          </div>

        <!-- Water System Card -->
        <div class="card card-lg">
          <div class="card-header">
            <h2 class="card-title">
              <i class="fas fa-tint"></i>
              Système d'eau
            </h2>
          </div>

          <div class="status-details">
            <div class="status-item">
              <div class="status-label">État du système</div>
              <div class="status-value" [ngClass]="{'active': isWaterSystemActive, 'inactive': !isWaterSystemActive}">
                <button class="toggle-btn" (click)="toggleWaterSystem()">
                  {{ isWaterSystemActive ? 'Actif' : 'Inactif' }}
                  <i class="fas" [ngClass]="{'fa-play-circle': !isWaterSystemActive, 'fa-stop-circle': isWaterSystemActive}"></i>
                </button>
              </div>
            </div>
          </div>

          <div class="progress-container">
            <h3>Niveau du réservoir d'eau</h3>
            <div class="progress-bar">
              <div class="progress" 
                   [style.width.%]="waterTankLevel"
                   [ngClass]="{
                     'low': waterTankLevel < 20,
                     'medium': waterTankLevel >= 20 && waterTankLevel < 50,
                     'high': waterTankLevel >= 50
                   }">
                <div class="progress-text">{{ waterTankLevel }}%</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Daily Statistics Card -->
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">
              <i class="fas fa-chart-bar"></i>
              Statistiques quotidiennes
            </h2>
          </div>

          <div class="stat-grid">
            <div class="stat-box">
              <h3>Aliments consommés</h3>
              <div class="value">{{ dailyFoodConsumption | number:'1.0-1' }} kg</div>
            </div>
            <div class="stat-box">
              <h3>Eau consommée</h3>
              <div class="value">{{ dailyWaterConsumption | number:'1.0-1' }} L</div>
            </div>
            <div class="stat-box">
              <h3>Distributions</h3>
              <div class="value">{{ dailyDistributions }}</div>
            </div>
          </div>
        </div>

        
      </div>
    </div>
  </div>
</div>