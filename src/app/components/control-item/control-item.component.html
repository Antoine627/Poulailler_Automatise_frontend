<div class="control-item">
  <div class="control-header">
    <h3 class="title">
      {{title}}
      <span *ngIf="isLoading" class="loading-indicator">(en cours...)</span>
    </h3>
    <div class="action-icons">
      <fa-icon [icon]="faSync" 
               class="refresh-icon" 
               [class.spinning]="isRefreshing" 
               (click)="refreshData()"
               [title]="lastRefresh ? 'Dernière mise à jour: ' + (lastRefresh | date:'HH:mm:ss') : 'Rafraîchir'">
      </fa-icon>
      <fa-icon [icon]="faClock" 
               class="clock-icon" 
               (click)="openModal()"
               title="Planifier">
      </fa-icon>
    </div>
  </div>
  
  <div class="control-body">
    <div class="content-center">
      <!-- Section des valeurs -->
      <div *ngIf="(currentValue !== undefined && currentValue !== null) || type !== 'light'" class="value-section">
        <span class="value">{{currentValue}}</span>
        <span class="unit">{{unit}}</span>
        
        <!-- Indicateur de niveau si nécessaire pour les stocks -->
        <div *ngIf="requiresStock && initialValue > 0" class="stock-level-container">
          <div class="stock-level-bar">
            <div class="stock-level-fill" 
                 [style.width.%]="getStockPercentage()"
                 [ngClass]="{
                   'level-critical': getStockPercentage() < 20,
                   'level-warning': getStockPercentage() >= 20 && getStockPercentage() < 50,
                   'level-good': getStockPercentage() >= 50
                 }">
            </div>
          </div>
        </div>
      </div>
      
      <!-- Section de l'icône -->
      <div class="icon-section">
        <img [src]="getImageUrl()"
             [class.light-glow]="type === 'light' && isActive"
             [class.disabled]="requiresStock && currentValue <= 0"
             alt="{{type}} icon"
             class="control-icon"/>
      </div>
      
      <!-- Interrupteur -->
      <label class="switch" [class.disabled]="!isToggleable || (requiresStock && currentValue <= 0)">
        <input type="checkbox"
               [checked]="isActive"
               (change)="toggleActive()"
               [disabled]="!isToggleable || (requiresStock && currentValue <= 0) || isLoading">
        <span class="slider round"></span>
      </label>
    </div>
  </div>
  
  <div class="status-section">
    <div class="status" [ngClass]="{
      'status-active': isActive,
      'status-error': status === ControlStatus.ERROR || status === ControlStatus.NOT_FOUND,
      'status-warning': status === ControlStatus.LOW_STOCK,
      'status-empty': status === ControlStatus.NO_STOCK
    }">
      <span class="status-text">{{status}}</span>
      <span class="status-indicator" [class.on]="isActive"></span>
    </div>
    
    <div *ngIf="errorMessage" class="error-message">
      <fa-icon [icon]="faExclamationTriangle" class="error-icon"></fa-icon>
      {{errorMessage}}
    </div>
  </div>
</div>